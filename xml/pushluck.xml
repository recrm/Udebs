<udebs>

<config>
    <revert>0</revert>
    <version>2</version>
    <logging>False</logging>
<!--    <seed>4643</seed>-->
</config>

<definitions>
    <stats>
        <amount />

        <chests />
        <keys />
        <skulls />
        <lives />
    </stats>

    <lists>
        <cards />
    </lists>

</definitions>

<entities>
    <!-- Cards -->
    <cards />

    <boat>
        <amount>9</amount>
        <group>cards</group>
    </boat>

    <dmap>
        <amount>9</amount>
        <group>cards</group>
        <effect>
            <i>$caster CAST $target draw</i>
            <i>$caster CAST $target draw</i>
        </effect>
    </dmap>

    <map>
        <amount>9</amount>
        <group>cards</group>
        <effect>$caster CAST $target draw</effect>
    </map>

    <skull>
        <amount>9</amount>
        <group>cards</group>
        <effect>$caster skulls += 1</effect>
    </skull>

    <chest>
        <amount>9</amount>
        <group>cards</group>
        <effect>$caster chests += 1</effect>
    </chest>

    <key>
        <amount>9</amount>
        <group>cards</group>
        <effect>$caster keys += 1</effect>
    </key>

    <!-- system -->
    <hands />

    <hand>
        <group>hands</group>
        <lives>3</lives>
    </hand>

    <deck />

    <!-- Deck Actions -->
    <shuffle>
        <effect>
            <i>ALL.hands ACTION dumphand</i>
            <i>ALL.cards CAST $caster insert</i>
            <i>$caster cards SHUFFLE</i>
        </effect>
    </shuffle>

    <!-- Hand / deck interactions -->
    <draw>
        <require>
            <i>drawn = ($target.STAT.cards elem 0)</i>
            <i>$drawn != empty</i>
        </require>
        <effect>
            <i>$target cards LOSES $drawn</i>
            <i>$caster cards GETS $drawn</i>
            <i>$caster CAST $target $drawn</i>
        </effect>
    </draw>

    <insert>
        <require>$caster not-in $target.STAT.cards $caster.STAT.amount</require>
        <effect>
            <i>$target cards GETS $caster</i>
            <i>$caster CAST $target insert</i>
        </effect>
    </insert>

    <!-- Hand Actions -->
    <dumphand>
        <effect>
            <i>$caster CLEAR cards</i>
            <i>$caster chests REPLACE 0</i>
            <i>$caster keys REPLACE 0</i>
            <i>$caster skulls REPLACE 0</i>
        </effect>
    </dumphand>

    <checkdeath>
        <require>$caster.STAT.skulls &gt;= $caster.STAT.lives</require>
        <effect>
            <i>print $caster has died</i>
            <i>EXIT</i>
        </effect>
    </checkdeath>

    <tally>
        <effect>
            <i>chests = $caster.STAT.chests</i>
            <i>keys = $caster.STAT.keys</i>
            <i>score = (($chests * 2) + (min $chests $keys))</i>
            <i>print $caster has $score points</i>
            <i>print $caster has $caster.STAT.skulls skulls</i>
        </effect>
    </tally>

    <!-- System Actions -->
    <init>
        <effect>
            <i>deck ACTION shuffle</i>
            <i>hand CAST deck draw</i>
            <i>hand CAST deck draw</i>
            <i>hand CAST deck draw</i>
            <i>hand ACTION tally</i>
            <i>hand ACTION checkdeath</i>
        </effect>
    </init>

    <tick>
        <effect>
            <i>hand CAST deck draw</i>
            <i>hand ACTION tally</i>
            <i>hand ACTION checkdeath</i>
        </effect>
    </tick>

</entities>
</udebs>
