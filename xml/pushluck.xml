<udebs>

<config>
    <revert>2</revert>
    <version>2</version>
<!--    <seed>4643</seed>-->
</config>

<definitions>
    <stats>
        <points />
        <keys />
        <death />
    </stats>
    
    <lists>
        <cards />
    </lists>
    
</definitions>

<entities>
    <!-- Cards -->
    <boat>
        <group>cards</group>
    </boat>
    <map>
        <group>cards</group>
        <effect>
            <i>$caster CAST $target draw</i>
            <i>$caster CAST $target draw</i>
        </effect>
    </map>
    <skull>
        <group>cards</group>
        <death>1</death>
    </skull>
    <chest>
        <group>cards</group>
        <points>1</points>
    </chest>
    <key>
        <group>cards</group>
        <keys>1</keys>
    </key>

    <!-- system -->
    <hand />
    <deck />
    <cards />

    <!-- Deck Actions -->
    <fill>
        <require>
            <i>$caster not-in $target.STAT.cards 9</i>
        </require>
        <effect>
            <i>$target cards GETS $caster</i>
            <i>$caster CAST $target fill</i>
        </effect>
    </fill>
    
    <shuffle>
        <effect>
            <i>$caster CLEAR cards</i>
            <i>ALL.cards CAST $target fill</i>
            <i>$target cards SHUFFLE</i>
        </effect>
    </shuffle>
    
    <draw>
        <effect>
            <i>drawn = (deck.STAT.cards elem 0)</i>
            <i>$target cards LOSES $drawn</i>
            <i>$caster cards GETS $drawn</i>
            <i>$caster CAST $target $drawn</i>
        </effect>
    </draw>
    
    <!-- Scoring Actions -->
    <death>
        <require>($target.STAT.cards LISTSTAT death) &gt;= 3</require>
        <effect>
            <i>print $target.STAT.cards</i>
            <i>print $target has died</i>
            <i>EXIT</i>
        </effect>
    </death>
    
    <tally>
        <effect>
            <i>chests = ($target.STAT.cards LISTSTAT points)</i>
            <i>keys = ($target.STAT.cards LISTSTAT keys)</i>
            <i>score = (($chests * 2) + (min $chests $keys))</i>
            <i>print $target has $score points</i>
        </effect>
    </tally>
    
    <!-- System Actions -->
    <init>
        <effect>
            <i>hand CAST deck shuffle</i>
            <i>(TIME)</i>
            <i>hand CAST deck draw</i>
            <i>hand CAST deck draw</i>
            <i>hand CAST deck draw</i>
            <i>CAST hand tally</i>
            <i>CAST hand death</i>
        </effect>
    </init>
    
    <tick>
        <effect>
            <i>hand CAST deck draw</i>
            <i>CAST hand tally</i>
            <i>CAST hand death</i>
        </effect>
    </tick>
    
</entities>
</udebs>
