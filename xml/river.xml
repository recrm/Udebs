<udebs>

<config>
    <hex>True</hex>
    <logging>False</logging>
</config>

<definitions>
    <stats>
        <W />
        <D />
        <S />
    </stats>
    <lists>
        <change />
    </lists>   
    <strings>
        <colour />
    </strings>
</definitions>

<map>
    <dim>
        <x>16</x>
        <y>16</y>
    </dim>
</map>

<entities>
    <!-- scripts -->
    <init>
        <effect>
            <i>RECRUIT 'land' (FILL (0,0) 'empty')</i>
            <i>MOVE 'source' (0,8)</i>
            <i>MOVE 'pit' (15,8)</i>
            <i>CAST (FILL 'source' 'empty') 'terrain'</i>
        </effect>
    </init>
    
    <terrain>
        <effect>CHANGE T 'D' (DICE 10)</effect>
    </terrain>
    
    <tick>
        <effect>
            <i>CHANGE 'source' 'W' 4</i>
            <i>source CAST (FILL 'source' 'adjacent') 'flow'</i>
            <i>CHANGE pit 'W' -1</i>
        </effect>
    </tick>
    
    <adjacent>
        <require>DISTANCE 'hex' == 1</require>
    </adjacent>
        
    <!-- moves --> 
    
    <flow>
        <require>(STAT T 'W' + STAT T 'D') &lt; (STAT C 'W' + STAT C 'D' - 1)</require> 
        <effect>
            <i>amount = min((STAT C 'W' + STAT C 'D' - STAT T 'W' - STAT T 'D' + 10)/10 , STAT C W)</i>
            <i>CHANGE T 'W' amount</i>
            <i>CHANGE C 'W' -amount</i>
            <i>CHANGE C 'S' 1</i>
            <i>CAST T 'colourchange'</i>
            <i>CAST T 'erode'</i>
            <i>target CAST (FILL target 'adjacent') 'flow'</i>
        </effect>
    </flow> 
    
    <erode>
        <require>STAT T 'S' >= 10</require>
        <effect>
            <i>CHANGE T 'S' -10</i>
            <i>CHANGE T 'D' -1</i>
        </effect>
    </erode>
    
    <colourchange>
        <require>target.name != 'pit'</require>
        <effect>REPLACE T colour (S colourchange change)[min(int(STAT T 'W' / 10), 4)]</effect>
        <change>
            <i>sand</i>
            <i>dirt</i>
            <i>grass</i>
            <i>shallow</i>
            <i>deep</i>
        </change>
    </colourchange>
    
    <!-- land squares -->

    <land>
        <D>500</D>
        <colour>sand</colour>
    </land>
    
    <source>
        <D>0</D>
        <W>500</W>
        <colour>deep</colour>
    </source>    
    
    <pit>
        <D>10</D>
        <colour>black</colour>
    </pit>
    
</entities>

</udebs>
