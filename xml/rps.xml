<udebs>

<definitions>
    <stats>
        <lives />
    </stats>
    <strings>
        <choice />
        <beats />
    </strings>
    <lists>
        <options />
        <registered />
    </lists>
</definitions>

<config>
    <version>2</version>
    <name>RPS</name>
    <logging>False</logging>
</config>

<entities>
    <!-- Game Actions -->
    <checkresults>
        <options>
            <i>rock</i>
            <i>paper</i>
            <i>scissors</i>
        </options>
        
        <require>
            <i>user.NAME in checkresults.STAT.registered</i>
            <i>computer.NAME in checkresults.STAT.registered</i>
        </require>
        
        <effect>
            <i>TIME 1</i>
            <i>user choice REPLACE ''</i>
            <i>computer choice REPLACE ''</i>
            <i>checkresults CLEAR registered</i>
            <i>print user has user.STAT.lives lives</i>
            <i>print computer has computer.STAT.lives lives</i>
            <i>INIT gameover</i>
        </effect>
    </checkresults>
    
    <gameover>
        <require>(user.STAT.lives * computer.STAT.lives) &lt;= 0</require>
        <effect>
            <i>print The game is over</i>
            <i>EXIT</i>
        </effect>
    </gameover>
    
    <!-- Allowed player actions -->
    
    <throw>
        <require>
            <i>$caster.STAT.choice == ''</i>
            <i>$caster.NAME not-in checkresults.STAT.registered</i>
        </require>
        <effect>
            <i>$caster choice REPLACE $move.NAME</i>
            <i>checkresults registered GETS $caster.NAME</i>
            <i>DELAY `(print $caster uses $move on $target) 1</i>
            <i>DELAY `($caster CAST $target $move.STAT.choice) 1</i>
            <i>print $caster move registered</i>
            <i>INIT checkresults</i>
        </effect>
    </throw>
    
    <rock>
        <group>throw</group>
        <choice>colliderock</choice>
    </rock>
    
    <paper>
        <group>throw</group>
        <choice>collidepaper</choice>
    </paper>
    
    <scissors>
        <group>throw</group>
        <choice>collidescissors</choice>
    </scissors>
    
    <!-- collisions -->
    <collision>
        <require>$move.STAT.beats == $target.STAT.choice</require>
        <effect>
            <i>$target lives -= 1</i>
            <i>print $target lost a life</i>
        </effect>
    </collision>
    
    <colliderock>
        <group>collision</group>
        <beats>scissors</beats>
    </colliderock>
    
    <collidepaper>
        <group>collision</group>
        <beats>rock</beats>
    </collidepaper>
    
    <collidescissors>
        <group>collision</group>
        <beats>paper</beats>
    </collidescissors>
    
    <!-- Players -->
    <user>
        <lives>5</lives>
    </user>

    <computer>
        <lives>5</lives>
    </computer>

</entities>

</udebs>