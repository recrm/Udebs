<udebs>

<definitions>
    <lists>
        <colour />
        <status />
        <movelist />
    </lists>
    <stats>
        <ACT />
        <SPD />
        <FLP />
    </stats>
    <strings>
        <sprite />
    </strings>
</definitions>

<map>
    <dim>
        <x>8</x>
        <y>8</y>
    </dim>
</map>

<entities>
    
    <!-- fill -->
    
    <fill_pawn>
        <require>
            <item>DISTANCE y == 0</item>
        </require>
    </fill_pawn>
    
    <nonempty>
        <require>
            <item>target.name != 'empty'</item>
        </require>
    </nonempty>
    
    <!-- scripts -->
    
    <init>
        <effect>
            <item>'black' CAST 'brecruit' 'empty'</item>
            <item>'white' CAST 'wrecruit' 'empty'</item>
        </effect>
    </init>

    <brecruit>
        <effect>
            <item>RECRUIT 'pawn' (FILL (0,1) 'fill_pawn')</item>
            <item>RECRUIT 'rook' (0,0)</item>
            <item>RECRUIT 'rook' (7,0)</item>
            <item>RECRUIT 'knight' (1,0)</item>
            <item>RECRUIT 'knight' (6,0)</item>
            <item>RECRUIT 'bishop' (2,0)</item>
            <item>RECRUIT 'bishop' (5,0)</item>
            <item>RECRUIT 'king' (3,0)</item>
            <item>RECRUIT 'queen' (4,0)</item>
            <item>GETS group 'black' (FILL (0,1) 'nonempty')</item>
        </effect>
    </brecruit>
    
    <wrecruit>
        <effect>
            <item>RECRUIT 'pawn' (FILL (0,6) 'fill_pawn')</item>
            <item>RECRUIT 'rook' (0,7)</item>
            <item>RECRUIT 'rook' (7,7)</item>
            <item>RECRUIT 'knight' (1,7)</item>
            <item>RECRUIT 'knight' (6,7)</item>
            <item>RECRUIT 'bishop' (2,7)</item>
            <item>RECRUIT 'bishop' (5,7)</item>
            <item>RECRUIT 'king' (3,7)</item>
            <item>RECRUIT 'queen' (4,7)</item>
            <item>GETS group 'white' (FILL (0,6) 'nonempty')</item>
        </effect>
    </wrecruit>
    
    <!-- commented out items force players to take turns. -->
    <tick>
       <!-- 
       <require>
            <item>'tick' in STAT group target</item>
        </require>
        <effect>
            <item>CHANGE ACT (STAT SPD target) target</item>
        </effect> -->
    </tick>
    
    <!-- statuses effects -->
    
    <status_group>
        <require>
            <item>move.name not in STAT status target</item>
        </require>
        <effect>
            <item>GETS status move.name target</item>
        </effect>
    </status_group>
    
    <moved_once>
        <group>
            <item>status_group</item>
        </group>
    </moved_once>
    
    <passant_danger>
        <effect>
            <item>CAST 'passant_remove' target DELAY 2</item>
        </effect>
        <group>
            <item>status_group</item>
        </group>
    </passant_danger>
    
    <promoted>
        <group>
            <item>status_group</item>
        </group>
    </promoted>
    
    <captured>
        <require>
            <item>target.name != 'empty'</item>
        </require>
        <group>
            <item>status_group</item>
        </group>
    </captured>
    
    <!-- chain casts -->
    
    <promote>
        <require>
            <item>caster.loc[1] in [0,7]</item>
        </require>
        <effect>
            <item>RECRUIT 'queen' caster</item>
            <item>GETS group (CLASS 'tick' caster) new</item>
            <item>GETS status 'promoted' caster</item>
        </effect>
    </promote>
    
    <passant_remove>
        <effect>
            <item>LOSES status 'passant_danger' target</item>
        </effect>
    </passant_remove>
    
    <!-- moves groups -->

    <time>
        <!--<require>
            <item>STAT ACT caster &gt;= 2</item>
        </require>
        <effect>
            <item>CHANGE ACT (- STAT ACT caster) (CLASS tick caster)</item>
        </effect>-->
    </time>
        
    <player_move>
        <require>
            <item>CLASS 'tick' caster not in STAT group target</item>
        </require>
        <effect>
            <item>CAST 'moved_once' caster</item>
            <item>CAST 'captured' target</item>
        </effect>
    </player_move>

    <pawn_move>
        <require>
            <item>(target.loc[1] * STAT FLP C) &lt; (caster.loc[1] * STAT FLP C)</item>
        </require>
        <effect>
            <item>TRAVEL target</item>
            <item>CAST 'promote' caster</item>
        </effect>
    </pawn_move>
    
    <king_castle>
        <require>
            <item>CLASS 'tick' caster in STAT group target</item>
            <item>'rook' in target.name</item>
            <item>'moved_once' not in STAT status caster</item>
            <item>'moved_once' not in STAT status target</item>
            <item>BLOCK x</item>
        </require>
        <effect>
            <item>CAST 'moved_once' caster</item>
            <item>CAST 'moved_once' target</item>
        </effect>
    </king_castle>
    
    <!-- moves -->

    <pawn_travel>
        <require>
            <item>DISTANCE y == 1</item>
            <item>DISTANCE x == 0</item>
            <item>target.name == 'empty'</item>            
        </require>
        <group>
            <item>player_move</item>
            <item>time</item>
            <item>pawn_move</item>
        </group>
    </pawn_travel>

    <pawn_double>
        <require>
            <item>'moved_once' not in STAT status caster</item>
            <item>DISTANCE x == 0</item>
            <item>DISTANCE y == 2</item>
            <item>target.name == 'empty'</item>
            <item>BLOCK y</item>
        </require>
        <effect>
            <item>CAST 'passant_danger' caster</item>
        </effect>
        <group>
            <item>player_move</item>
            <item>pawn_move</item>
            <item>time</item>
        </group>
    </pawn_double>
    
    <pawn_capture>
        <require>
            <item>DISTANCE pinf == 1</item>
            <item>DISTANCE x == DISTANCE y</item>
            <item>target.name != 'empty'</item>
        </require>
        <group>
            <item>player_move</item>
            <item>pawn_move</item>
            <item>time</item>
        </group>
    </pawn_capture>

    <pawn_passant>
        <require>
            <item>'passant_danger' in STAT status target</item>
            <item>DISTANCE x == 1</item>
            <item>DISTANCE y == 0</item>
        </require>
        <effect>
            <item>TRAVEL (target.loc[0], caster.loc[1] - STAT FLP C)</item>
            <item>target TRAVEL False</item>
        </effect>
        <group>
            <item>player_move</item>
            <item>time</item>
        </group>
    </pawn_passant>
    
    <king_qcastle>
        <require>
            <item>target.loc[0] &gt; caster.loc[0]</item>
        </require>
        <effect>
            <item>TRAVEL (caster.loc[0] +2, caster.loc[1])</item>
            <item>target TRAVEL (target.loc[0] -3, caster.loc[1])</item>
        </effect>
        <group>
            <item>king_castle</item>
            <item>time</item>
        </group>
    </king_qcastle>
    
    <king_kcastle>
        <require>
            <item>target.loc[0] &lt; caster.loc[0]</item>
        </require>
        <effect>
            <item>TRAVEL (caster.loc[0] - 2, caster.loc[1])</item>
            <item>target TRAVEL (target.loc[0] +2, caster.loc[1])</item>
        </effect>
        <group>
            <item>king_castle</item>
            <item>time</item>
        </group>
    </king_kcastle>
    
    <rook_travel>
        <require>
            <item>(DISTANCE p1 == DISTANCE x) or (DISTANCE p1 == DISTANCE y)</item>
            <item>BLOCK x</item>
        </require>
        <effect>
            <item>TRAVEL target</item>
        </effect>
        <group>
            <item>player_move</item>
            <item>time</item>
        </group>
    </rook_travel>
    
    <bishop_travel>
        <require>
            <item>DISTANCE pinf == DISTANCE x</item>
            <item>DISTANCE pinf == DISTANCE y</item>
            <item>BLOCK diag</item>
        </require>
        <effect>
            <item>TRAVEL target</item>
        </effect>
        <group>
            <item>player_move</item>
            <item>time</item>
        </group>
    </bishop_travel>
    
    <knight_travel>
        <require>
            <item>DISTANCE x == 2 and DISTANCE y == 1 or DISTANCE x == 1 and DISTANCE y == 2</item>
        </require>
        <effect>
            <item>TRAVEL target</item>
        </effect>
        <group>
            <item>player_move</item>
            <item>time</item>
        </group>
    </knight_travel>
    
    <king_travel>
        <require>
            <item>DISTANCE pinf == 1</item>
        </require>
        <effect>
            <item>TRAVEL target</item>
        </effect>
        <group>
            <item>player_move</item>
            <item>time</item>
        </group>
    </king_travel>
    
    <!-- units -->

    <pawn>
        <movelist>
            <item>pawn_travel</item>
            <item>pawn_double</item>
            <item>pawn_capture</item>
            <item>pawn_passant</item>
        </movelist>
        <sprite>P</sprite>
    </pawn>
    
    <bishop>
        <movelist>
            <item>bishop_travel</item>
        </movelist>
        <sprite>B</sprite>
    </bishop>
    
    <rook>
        <movelist>
            <item>rook_travel</item>
        </movelist>
        <sprite>R</sprite>
    </rook>
    
    <queen>
        <movelist>
            <item>bishop_travel</item>
            <item>rook_travel</item>
        </movelist>
        <sprite>Q</sprite>
    </queen>
    
    <king>
        <movelist>
            <item>king_kcastle</item>
            <item>king_qcastle</item>
            <item>king_travel</item>
        </movelist>
        <sprite>K</sprite>
    </king>
    
    <knight>
        <movelist>
            <item>knight_travel</item>
        </movelist>
        <sprite>N</sprite>
    </knight>

    <!-- Tick -->
    <black>
        <ACT>1</ACT>
        <SPD>1</SPD>
        <FLP>-1</FLP>
        <colour>
            <item>3</item>
            <item>100</item>
            <item>3</item>
        </colour>
        <group>
            <item>tick</item>
        </group>
    </black>
    
    <white>
        <ACT>2</ACT>
        <SPD>1</SPD>
        <FLP>1</FLP>
        <colour>
            <item>100</item>
            <item>3</item>
            <item>100</item>
        </colour>
        <group>
            <item>tick</item>
        </group>
    </white>
</entities>

</udebs>
