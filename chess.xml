<udebs>

<config>
    <revert>5</revert>
</config>


<entities>
    
    <!-- move classes -->
    <entity>
        <ID>player_block</ID>
        <require>
            <item>CASTER CLASS player not in TARGET group</item>
        </require>
    </entity>
    
    <entity>
        <ID>player_move</ID>
        <effect>
            <!-- <item>CASTER CLASS player CHANGE ACT ( - CASTER ACT )</item> -->
            <item>CASTER CAST moved_once</item>
            <item>TARGET CAST captured</item>
        </effect>
        <require>
            <item>CASTER ACT &gt;= 2</item>
        </require>
    </entity>
    
    <entity>
        <ID>pawn_white</ID>
        <require>
            <item>TARGET POSITION y &lt; CASTER POSITION y</item>
        </require>
        <effect>
            <item>CASTER CAST W_promote</item>
        </effect>
    </entity>
    
    <entity>
        <ID>pawn_black</ID>
        <require>
            <item>TARGET POSITION y &gt; CASTER POSITION y</item>
        </require>
        <effect>
            <item>CASTER CAST B_promote</item>
        </effect>
    </entity>
    
    <entity>
        <ID>pawn_travel</ID>
        <effect>
            <item>TRAVEL</item>
        </effect>
        <require>
            <item>DISTANCE y == 1</item>
            <item>DISTANCE x == 0</item>
            <item>TARGET == empty</item>            
        </require>
    </entity>
    
    <entity>
        <ID>pawn_double</ID>
        <effect>
            <item>TRAVEL</item>
            <item>CASTER CAST passant_danger</item>
        </effect>
        <require>
            <item>moved_once not in CASTER status</item>
            <item>DISTANCE x == 0</item>
            <item>DISTANCE y == 2</item>
            <item>TARGET == empty</item>
            <item>BLOCK y</item>
        </require>
    </entity>
    
    <entity>
        <ID>pawn_capture</ID>
        <effect>
            <item>TRAVEL</item>
        </effect>
        <require>
            <item>DISTANCE pinf == 1</item>
            <item>DISTANCE x == DISTANCE y</item>
            <item>TARGET != empty</item>
            <item>CASTER CLASS player not in TARGET group</item>
        </require>
    </entity>
    
    <entity>
        <ID>pawn_passant</ID>
        <effect>
            <item>TARGET BUMP</item>
        </effect>
        <require>
            <item>passant_danger in TARGET status</item>
            <item>DISTANCE x == 1</item>
            <item>DISTANCE y == 0</item>
        </require>
    </entity>
    
    <!-- statuses -->
    
    <entity>
        <ID>W_promote</ID>
        <require>
            <item>TARGET POSITION y == 0</item>
            <item>white_pawn in TARGET group</item>
        </require>
        <effect>
            <item>W_queen RECRUIT ( TARGET POSITION x , TARGET POSITION y )</item>
        </effect>
    </entity>
    
    <entity>
        <ID>B_promote</ID>
        <require>
            <item>TARGET POSITION y == 7</item>
            <item>black_pawn in TARGET group</item>
        </require>
        <effect>
            <item>B_queen RECRUIT ( TARGET POSITION x , TARGET POSITION y )</item>
        </effect>
    </entity>
    
    <entity>
        <ID>moved_once</ID>
        <require>
            <item>SELF not in TARGET status</item>
        </require>
        <effect>
            <item>TARGET GETS status SELF</item>
        </effect>
    </entity>
    
    <entity>
        <ID>passant_danger</ID>
        <require>
            <item>SELF not in TARGET status</item>
        </require>
        <effect>
            <item>TARGET GETS status SELF</item>
            <item>TARGET CAST passant_remove DELAY 2</item>
        </effect>
    </entity>
    
    <entity>
        <ID>captured</ID>
        <require>
            <item>SELF not in TARGET status</item>
            <item>CASTER CLASS player not in TARGET group</item>
            <item>TARGET != empty</item>
        </require>
    </entity>
    
    <!-- moves -->
    
    <entity>
        <ID>white_pawn_travel</ID>
        <group>
            <item>player_block</item>
            <item>player_move</item>
            <item>pawn_travel</item>
            <item>pawn_white</item>
        </group>
    </entity>
    
    <entity>
        <ID>white_pawn_double</ID>
        <group>
            <item>player_block</item>
            <item>player_move</item>
            <item>pawn_double</item>
            <item>pawn_white</item>
        </group>
    </entity>
    
    <entity>
        <ID>white_pawn_capture</ID>
        <group>
            <item>player_block</item>
            <item>player_move</item>
            <item>pawn_capture</item>
            <item>pawn_white</item>
        </group>
    </entity>
    
    <entity>
        <ID>white_pawn_passant</ID>
        <effect>
            <item>TARGET CAST W_qpassant</item>
            <item>TARGET CAST W_kpassant</item>
        </effect>
        <group>
            <item>player_block</item>
            <item>player_move</item>
            <item>pawn_passant</item>
        </group>
    </entity>
    
    <entity>
        <ID>black_pawn_travel</ID>
        <group>
            <item>player_block</item>
            <item>player_move</item>
            <item>pawn_travel</item>
            <item>pawn_black</item>
        </group>
    </entity>
    
    <entity>
        <ID>black_pawn_double</ID>
        <group>
            <item>player_block</item>
            <item>player_move</item>
            <item>pawn_double</item>
            <item>pawn_black</item>
        </group>
    </entity>
    
    <entity>
        <ID>black_pawn_capture</ID>
        <group>
            <item>player_block</item>
            <item>player_move</item>
            <item>pawn_capture</item>
            <item>pawn_black</item>
        </group>
    </entity>
    
    <entity>
        <ID>black_pawn_passant</ID>
        <effect>
            <item>TARGET CAST B_qpassant</item>
            <item>TARGET CAST B_kpassant</item>
        </effect>
        <group>
            <item>player_block</item>
            <item>player_move</item>
            <item>pawn_passant</item>
        </group>
    </entity>
    
    <entity>
        <ID>rook_travel</ID>
        <effect>
            <item>TRAVEL</item>
        </effect>
        <require>
            <item>DISTANCE p1 == DISTANCE x or DISTANCE p1 == DISTANCE y</item>
            <item>BLOCK x</item>
        </require>
        <group>
            <item>player_block</item>
            <item>player_move</item>
        </group>
    </entity>
    
    <entity>
        <ID>bishop_travel</ID>
        <effect>
            <item>TRAVEL</item>
        </effect>
        <require>
            <item>DISTANCE pinf == DISTANCE x</item>
            <item>DISTANCE pinf == DISTANCE y</item>
            <item>BLOCK diag</item>
        </require>
        <group>
            <item>player_block</item>
            <item>player_move</item>
        </group>
    </entity>
    
    <entity>
        <ID>knight_travel</ID>
        <effect>
            <item>TRAVEL</item>
        </effect>
        <require>
            <item>( DISTANCE x == 2 and DISTANCE y == 1 ) or ( DISTANCE x == 1 and DISTANCE y == 2 )</item>
        </require>
        <group>
            <item>player_block</item>
            <item>player_move</item>
        </group>
    </entity>
    
    <entity>
        <ID>king_travel</ID>
        <effect>
            <item>TRAVEL</item>
        </effect>
        <require>
            <item>DISTANCE pinf == 1</item>
        </require>
        <group>
            <item>player_block</item>
            <item>player_move</item>
        </group>
    </entity>
    
    <entity>
        <ID>king_castle</ID>
        <effect>
            <item>TARGET CAST king_qcastle</item>
            <item>TARGET CAST king_kcastle</item>
            <item>TARGET CAST moved_once</item>
        </effect>
        <require>
            <item>CASTER CLASS player in TARGET group</item>
            <item>rook in TARGET group</item>
            <item>moved_once not in CASTER status</item>
            <item>moved_once not in TARGET status</item>
            <item>BLOCK x</item>
        </require>
        <group>
            <item>player_move</item>
        </group>
    </entity>

<!-- Chain Casting Moves and Checks -->
    <entity>
        <ID>passant_remove</ID>
        <effect>
            <item>TARGET LOSES status passant_danger</item>
        </effect>
    </entity>
    
    <entity>
        <ID>king_qcastle</ID>
        <effect>
            <item>CASTER MOVE x -2</item>
            <item>TARGET MOVE x 3</item>
        </effect>
        <require>
            <item>'q' in TARGET ID</item>
        </require>
    </entity>
    
    <entity>
        <ID>king_kcastle</ID>
        <effect>
            <item>CASTER MOVE x 2</item>
            <item>TARGET MOVE x -2</item>
        </effect>
        <require>
            <item>'q' not in TARGET ID</item>
        </require>
    </entity>
    
    <entity>
        <ID>W_qpassant</ID>
        <require>
            <item>TARGET POSITION x &lt; CASTER POSITION x</item>
        </require>
        <effect>
            <item>CASTER MOVE xy (-1, -1)</item>
        </effect>
    </entity>
    
    <entity>
        <ID>W_kpassant</ID>
        <require>
            <item>TARGET POSITION x &gt; CASTER POSITION x</item>
        </require>
        <effect>
            <item>CASTER MOVE xy (1, -1)</item>
        </effect>
    </entity>
    
    <entity>
        <ID>B_qpassant</ID>
        <require>
            <item>TARGET POSITION x &lt; CASTER POSITION x</item>
        </require>
        <effect>
            <item>CASTER MOVE xy (-1, 1)</item>
        </effect>
    </entity>
    
    <entity>
        <ID>B_kpassant</ID>
        <require>
            <item>TARGET POSITION x &gt; CASTER POSITION x</item>
        </require>
        <effect>
            <item>CASTER MOVE xy (1, 1)</item>
        </effect>
    </entity>
        

</entities>

<units>

    <!-- Unit classes -->
    <unit tick='tick'>
        <type>player</type>
        <ID>black</ID>     
        <stats>
            <ACT>1</ACT>
            <SPD>1</SPD>
        </stats>
    </unit>
    
    <unit tick='tick'>
        <type>player</type>
        <ID>white</ID>     
        <stats>
            <ACT>2</ACT>
            <SPD>1</SPD>
        </stats>
    </unit>
    
    <unit>
        <ID>white_pawn</ID>     
        <movelist>
            <item>white_pawn_travel</item>
            <item>white_pawn_double</item>
            <item>white_pawn_capture</item>
            <item>white_pawn_passant</item>
        </movelist> 
    </unit>
    
    <unit>
        <ID>black_pawn</ID>     
        <movelist>
            <item>black_pawn_travel</item>
            <item>black_pawn_double</item>
            <item>black_pawn_capture</item>
            <item>black_pawn_passant</item>
        </movelist> 
    </unit>
    
    <unit>
        <ID>bishop</ID>     
        <movelist>
            <item>bishop_travel</item>
        </movelist> 
    </unit>
    
    <unit>
        <ID>rook</ID>     
        <movelist>
            <item>rook_travel</item>
        </movelist> 
    </unit>
    
    <unit>
        <ID>queen</ID>     
        <movelist>
            <item>bishop_travel</item>
            <item>rook_travel</item>
        </movelist> 
    </unit>
    
    <unit>
        <ID>king</ID>     
        <movelist>
            <item>king_castle</item>
            <item>king_travel</item>
        </movelist> 
    </unit>
    
    <unit>
        <ID>knight</ID>     
        <movelist>
            <item>knight_travel</item>
        </movelist> 
    </unit>
    
    <!-- white units -->
    
    <unit active='active'>
        <ID>W_1pawn</ID>     
        <group>
            <item>white</item>
            <item>white_pawn</item>
        </group> 
    </unit>
    
    <unit active='active'>
        <ID>W_2pawn</ID>     
        <group>
            <item>white</item>
            <item>white_pawn</item>
        </group> 
    </unit>
    
    <unit active='active'>
        <ID>W_3pawn</ID>     
        <group>
            <item>white</item>
            <item>white_pawn</item>
        </group> 
    </unit>
    
    <unit active='active'>
        <ID>W_4pawn</ID>     
        <group>
            <item>white</item>
            <item>white_pawn</item>
        </group> 
    </unit>
    
    <unit active='active'>
        <ID>W_5pawn</ID>     
        <group>
            <item>white</item>
            <item>white_pawn</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>W_6pawn</ID>     
        <group>
            <item>white</item>
            <item>white_pawn</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>W_7pawn</ID>     
        <group>
            <item>white</item>
            <item>white_pawn</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>W_8pawn</ID>     
        <group>
            <item>white</item>
            <item>white_pawn</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>W_qrook</ID>     
        <group>
            <item>white</item>
            <item>rook</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>W_krook</ID>     
        <group>
            <item>white</item>
            <item>rook</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>W_qbishop</ID>     
        <group>
            <item>white</item>
            <item>bishop</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>W_kbishop</ID>     
        <group>
            <item>white</item>
            <item>bishop</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>W_qknight</ID>     
        <group>
            <item>white</item>
            <item>knight</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>W_kknight</ID>     
        <group>
            <item>white</item>
            <item>knight</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>W_queen</ID>     
        <group>
            <item>white</item>
            <item>queen</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>W_king</ID>     
        <group>
            <item>white</item>
            <item>king</item>
        </group> 
    </unit>
   
    <!-- black Units -->
    
    <unit  active='active'>
        <ID>B_1pawn</ID>     
        <group>
            <item>black</item>
            <item>black_pawn</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_2pawn</ID>     
        <group>
            <item>black</item>
            <item>black_pawn</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_3pawn</ID>     
        <group>
            <item>black</item>
            <item>black_pawn</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_4pawn</ID>     
        <group>
            <item>black</item>
            <item>black_pawn</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_5pawn</ID>     
        <group>
            <item>black</item>
            <item>black_pawn</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_6pawn</ID>     
        <group>
            <item>black</item>
            <item>black_pawn</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_7pawn</ID>     
        <group>
            <item>black</item>
            <item>black_pawn</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_8pawn</ID>     
        <group>
            <item>black</item>
            <item>black_pawn</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_qrook</ID>     
        <group>
            <item>black</item>
            <item>rook</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_krook</ID>     
        <group>
            <item>black</item>
            <item>rook</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_qbishop</ID>     
        <group>
            <item>black</item>
            <item>bishop</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_kbishop</ID>     
        <group>
            <item>black</item>
            <item>bishop</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_qknight</ID>     
        <group>
            <item>black</item>
            <item>knight</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_kknight</ID>     
        <group>
            <item>black</item>
            <item>knight</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_queen</ID>     
        <group>
            <item>black</item>
            <item>queen</item>
        </group> 
    </unit>
    
    <unit  active='active'>
        <ID>B_king</ID>     
        <group>
            <item>black</item>
            <item>king</item>
        </group> 
    </unit> 
</units>

<MAP>
    <row>B_qrook, B_qknight, B_qbishop, B_queen, B_king, B_kbishop, B_kknight, B_krook</row>
    <row>B_1pawn, B_2pawn, B_3pawn, B_4pawn, B_5pawn, B_6pawn, B_7pawn, B_8pawn</row> 
    <row>empty, empty, empty, empty, empty, empty, empty, empty</row>
    <row>empty, empty, empty, empty, empty, empty, empty, empty</row>
    <row>empty, empty, empty, empty, empty, empty, empty, empty</row>
    <row>empty, empty, empty, empty, empty, empty, empty, empty</row>
    <row>W_1pawn, W_2pawn, W_3pawn, W_4pawn, W_5pawn, W_6pawn, W_7pawn, W_8pawn</row>
    <row>W_qrook, W_qknight, W_qbishop, W_queen, W_king, W_kbishop, W_kknight, W_krook</row>
</MAP>

</udebs>
