<udebs>

<config>
    <hex>True</hex>
    <logging>False</logging>
</config>

<definitions>
    <stats>
        <W />
        <D />
        <S />
    </stats>
    <strings>
        <colour />
    </strings>
</definitions>

<map>
    <dim>
        <x>16</x>
        <y>16</y>
    </dim>
</map>

<entities>
    <!-- scripts -->
    <init>
        <effect>
            <item>RECRUIT 'land' (FILL (0,0) 'empty')</item>
            <item>'source' TRAVEL (0,8)</item>
            <item>'pit' TRAVEL (15,8)</item>
            <item>CAST (FILL 'source' 'empty') 'terrain'</item>
        </effect>
    </init>
    
    <tick>
        <effect>
            <item>CHANGE 'source' 'W' 4</item>
            <item>'source' CAST (FILL 'source' 'adjacent') 'flow'</item>
        </effect>
    </tick>
    
    <terrain>
        <effect>
            <item>CHANGE T 'D' (DICE 10)</item>
        </effect>
    </terrain>
    
    <adjacent>
        <require>
            <item>DISTANCE 'hex' == 1</item>
        </require>
    </adjacent>
        
    <!-- moves --> 
    
    <flow>
        <require>
            <item>(STAT T 'W' + STAT T 'D') &lt; (STAT C 'W' + STAT C 'D' - 1)</item>
        </require> 
        <effect>
            <item>amount = (STAT C 'W' + STAT C 'D' - STAT T 'W' - STAT T 'D' + 10)/10</item>
            <item>CHANGE T 'W' amount</item>
            <item>CHANGE C 'W' -amount</item>
            <item>CHANGE C 'S' 1</item>
            <item>CAST T 'colourchange'</item>
            <item>CAST T 'erode'</item>
            <item>CAST T 'pitcheck'</item>
            <item>target CAST (FILL target 'adjacent') 'flow'</item>
        </effect>
    </flow> 
    
    <erode>
        <require>
            <item>STAT T 'S' >= 10</item>
        </require>
        <effect>
            <item>CHANGE T 'S' -10</item>
            <item>CHANGE T 'D' -1</item>
        </effect>
    </erode>
    
    <pitcheck>
        <require>
            <item>target.name == 'pit'</item>
        </require>
        <effect>
            <item>CHANGE T 'W' -1</item>
        </effect>
    </pitcheck>
    
    <colourchange>
        <require>
            <item>target.name != 'pit'</item>
        </require>
        <effect>
            <item>CAST T 'sand'</item>
            <item>CAST T 'dirt'</item>
            <item>CAST T 'grass'</item>
            <item>CAST T 'shallow'</item>
            <item>CAST T 'deep'</item>
        </effect>
    </colourchange>
    
    <!-- land squares -->

    <land>
        <colour>sand</colour>
        <D>500</D>
    </land>
    
    <source>
        <D>0</D>
        <W>500</W>
        <colour>deep</colour>
    </source>    
    
    <pit>
        <D>10</D>
        <colour>black</colour>
    </pit>
    
    <!-- colour changes -->
    
    <sand>
        <require>
            <item>STAT T 'W' &lt; 10</item>
            <item>STAT T 'W' &gt;= 0</item>
        </require>
        <effect>
            <item>REPLACE T 'colour' 'sand'</item>
        </effect>
    </sand>
    
    <dirt>
        <require>
            <item>STAT T 'W' &lt; 20</item>
            <item>STAT T 'W' &gt;= 10</item>
        </require>
        <effect>
            <item>REPLACE T 'colour' 'dirt'</item>
        </effect>
    </dirt>
    
    <grass>
        <require>
            <item>STAT T 'W' &lt; 30</item>
            <item>STAT T 'W' &gt;= 20</item>
        </require>
        <effect>
            <item>REPLACE T 'colour' 'grass'</item>
        </effect>
    </grass>
    
    <shallow>
        <require>
            <item>STAT T 'W' &lt; 40</item>
            <item>STAT T 'W' &gt;= 30</item>
        </require>
        <effect>
            <item>REPLACE T 'colour' 'shallow'</item>
        </effect>
    </shallow>
    
    <deep>
        <require>
            <item>STAT T 'W' &gt;= 40</item>
        </require>
        <effect>
            <item>REPLACE T 'colour' 'deep'</item>
        </effect>
    </deep>
</entities>

</udebs>
